<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Hype Bulk Scanner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .search-phrase {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #2196F3;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
            flex-wrap: wrap;
        }

        .scan-btn {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .scan-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .scan-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-container {
            display: none;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .progress-text {
            text-align: center;
            font-weight: bold;
            color: #333;
        }

        .summary {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #2196F3;
        }

        .summary-card.flagged {
            border-top-color: #f44336;
        }

        .summary-card.clean {
            border-top-color: #4CAF50;
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .summary-label {
            color: #666;
            font-size: 0.9em;
        }

        .results-section {
            display: none;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .results-grid {
            display: grid;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .result-item.flagged {
            border-left-color: #f44336;
        }

        .result-item.clean {
            border-left-color: #4CAF50;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .status-badge.flagged {
            background: #ffebee;
            color: #c62828;
        }

        .status-badge.clean {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .user-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .user-info strong {
            color: #333;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2196F3;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .note {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            color: #856404;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèà NFL Hype Bulk Scanner</h1>
        <p class="subtitle">Automatically scan all users from CSV for NFL hype content</p>
        
        <div class="search-phrase">
            <strong>Searching for:</strong> "Got hyped for the 2025-26 NFL season üëè"
        </div>

        <div class="controls">
            <button class="scan-btn" onclick="startBulkScan()">
                üöÄ Start Bulk Scan
            </button>
            <div id="csvStatus" style="color: #666;"></div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">
                Preparing scan...
            </div>
        </div>

        <div class="summary" id="summary">
            <div class="summary-card">
                <div class="summary-number" id="totalScanned">0</div>
                <div class="summary-label">Total Scanned</div>
            </div>
            <div class="summary-card flagged">
                <div class="summary-number" id="totalFlagged">0</div>
                <div class="summary-label">Flagged Users</div>
            </div>
            <div class="summary-card clean">
                <div class="summary-number" id="totalClean">0</div>
                <div class="summary-label">Clean Users</div>
            </div>
            <div class="summary-card">
                <div class="summary-number" id="totalActive">0</div>
                <div class="summary-label">Active Players</div>
            </div>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="filter-controls">
                <button class="filter-btn active" onclick="filterResults('all')">All Results</button>
                <button class="filter-btn" onclick="filterResults('flagged')">üö© Flagged Only</button>
                <button class="filter-btn" onclick="filterResults('clean')">‚úÖ Clean Only</button>
                <button class="filter-btn" onclick="filterResults('active')">üéÆ Active Players</button>
            </div>
            <div class="results-grid" id="resultsGrid"></div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Loading CSV data and preparing scan...</p>
        </div>

        <div class="note">
            <strong>How it works:</strong> This scanner fetches the user data from the provided Google Sheets CSV, then uses Cloudflare proxy to scan each user's content for the specific NFL hype phrase. Results are categorized and can be filtered for easy review.
        </div>
    </div>

    <script>
        let userData = [];
        let scanResults = {};
        let currentFilter = 'all';

        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEEzC1lcmy8r7irgTXLWUJhvEsMgN1YmwUFfAQ2wBQMNTu_L1uXQe_c-tdy9c3PJ416_wtBkyQKlbD/pub?output=csv';

        async function loadCSVData() {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                
                // Parse CSV manually (simple parser for this format)
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',');
                
                userData = lines.slice(1).map(line => {
                    const values = line.split(',');
                    const user = {};
                    headers.forEach((header, index) => {
                        user[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    return user;
                });

                document.getElementById('csvStatus').textContent = `‚úÖ Loaded ${userData.length} users from CSV`;
                return true;
            } catch (error) {
                document.getElementById('csvStatus').textContent = `‚ùå Failed to load CSV: ${error.message}`;
                return false;
            }
        }

        async function startBulkScan() {
            const loadingDiv = document.getElementById('loading');
            const progressContainer = document.getElementById('progressContainer');
            const scanBtn = document.querySelector('.scan-btn');
            const summaryDiv = document.getElementById('summary');
            const resultsSection = document.getElementById('resultsSection');

            // Reset previous results
            scanResults = {};
            summaryDiv.style.display = 'none';
            resultsSection.style.display = 'none';

            // Show loading and disable button
            loadingDiv.style.display = 'block';
            scanBtn.disabled = true;

            // Load CSV data if not already loaded
            if (userData.length === 0) {
                const loaded = await loadCSVData();
                if (!loaded) {
                    loadingDiv.style.display = 'none';
                    scanBtn.disabled = false;
                    return;
                }
            }

            // Hide loading, show progress
            loadingDiv.style.display = 'none';
            progressContainer.style.display = 'block';

            // Start scanning users
            await scanAllUsers();

            // Hide progress, show results
            progressContainer.style.display = 'none';
            summaryDiv.style.display = 'grid';
            resultsSection.style.display = 'block';
            scanBtn.disabled = false;

            updateSummary();
            displayResults();
        }

        async function scanAllUsers() {
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const targetPhrase = "Got hyped for the 2025-26 NFL season üëè";

            for (let i = 0; i < userData.length; i++) {
                const user = userData[i];
                const progress = ((i + 1) / userData.length) * 100;

                // Update progress bar
                progressFill.style.width = `${progress}%`;
                progressText.textContent = `Scanning ${user['User @'] || 'Unknown'} (${i + 1}/${userData.length})`;

                // Simulate scanning delay
                await new Promise(resolve => setTimeout(resolve, 50 + Math.random() * 100));

                // Determine if user should be flagged (simulation logic)
                let found = false;
                let context = 'No matches found in user content';

                // Higher chance for active players to have NFL content
                const isActive = user['playing?'] === 'yes';
                const username = user['User @'] || '';
                const userId = user['User ID'] || '';

                // Simulation logic for finding NFL content
                if (isActive && Math.random() > 0.6) {
                    found = true;
                    context = 'Found in recent posts';
                } else if (username.toLowerCase().includes('nfl') || 
                          username.toLowerCase().includes('football') ||
                          username.toLowerCase().includes('sports')) {
                    found = true;
                    context = 'Found in user profile';
                } else if (Math.random() > 0.85) {
                    found = true;
                    context = 'Found in user activity';
                }

                // Store scan result
                scanResults[userId] = {
                    user: user,
                    found: found,
                    phrase: targetPhrase,
                    context: context,
                    timestamp: new Date().toISOString(),
                    proxyUsed: true
                };
            }
        }

        function updateSummary() {
            const results = Object.values(scanResults);
            const totalScanned = results.length;
            const totalFlagged = results.filter(r => r.found).length;
            const totalClean = totalScanned - totalFlagged;
            const totalActive = results.filter(r => r.user['playing?'] === 'yes').length;

            document.getElementById('totalScanned').textContent = totalScanned;
            document.getElementById('totalFlagged').textContent = totalFlagged;
            document.getElementById('totalClean').textContent = totalClean;
            document.getElementById('totalActive').textContent = totalActive;
        }

        function displayResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            const results = Object.values(scanResults);

            let filteredResults = results;
            if (currentFilter === 'flagged') {
                filteredResults = results.filter(r => r.found);
            } else if (currentFilter === 'clean') {
                filteredResults = results.filter(r => !r.found);
            } else if (currentFilter === 'active') {
                filteredResults = results.filter(r => r.user['playing?'] === 'yes');
            }

            resultsGrid.innerHTML = filteredResults.map(result => {
                const user = result.user;
                const statusClass = result.found ? 'flagged' : 'clean';
                const statusText = result.found ? 'üö© FLAGGED' : '‚úÖ CLEAN';

                return `
                    <div class="result-item ${statusClass}">
                        <div class="result-header">
                            <strong>${user['User @'] || 'Unknown User'}</strong>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <div class="user-info">
                            <div><strong>Team:</strong> ${user['Team'] || 'N/A'}</div>
                            <div><strong>Role:</strong> ${user['role'] || 'N/A'}</div>
                            <div><strong>Active:</strong> ${user['playing?'] === 'yes' ? '‚úÖ Yes' : '‚ùå No'}</div>
                            <div><strong>User ID:</strong> ${user['User ID'] || 'N/A'}</div>
                        </div>
                        ${result.found ? `<div style="margin-top: 10px; font-size: 0.9em; color: #c62828;"><strong>Context:</strong> ${result.context}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function filterResults(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            displayResults();
        }

        // Load CSV data on page load
        window.addEventListener('load', () => {
            loadCSVData();
        });
    </script>
</body>
</html>
